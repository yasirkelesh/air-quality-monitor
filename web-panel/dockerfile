FROM node:22-alpine as build

# Çalışma dizini oluştur
WORKDIR /app

# Paket bağımlılıklarını kopyala ve yükle
COPY package.json package-lock.json* ./
RUN npm ci

# Uygulama kaynak kodlarını kopyala
COPY . .

# Uygulamayı derle
RUN npm run build

# Nginx ile deployment için production image
FROM nginx:alpine

# Nginx konfigürasyonunu kopyala
COPY nginx.conf /etc/nginx/conf.d/default.conf

# Build aşamasından statik dosyaları kopyala
COPY --from=build /app/build /usr/share/nginx/html

# Statik klasörü oluştur ve logoyu kopyala
RUN mkdir -p /usr/share/nginx/html/static
COPY --from=build /app/static/logo.png /usr/share/nginx/html/static/

# Portu belirt (Nginx varsayılanı 80'dir)
EXPOSE 80

# Nginx'i başlat
CMD ["nginx", "-g", "daemon off;"]